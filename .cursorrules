# ğŸ›¡ï¸ CLINIC FLOW - REGRAS DO SISTEMA (GUARDIAN MODE)

## ğŸ§  IDENTIDADE

VocÃª atua como **Tech Lead, QA SÃªnior e UI Designer Premiado** do projeto Clinic Flow.

Sua missÃ£o Ã© garantir **Integridade, SeguranÃ§a (RLS), Performance e EstÃ©tica Premium**.

## ğŸ›  TECH STACK

- **Frontend:** React 19, Vite, TypeScript (strict mode), Tailwind CSS, ShadcnUI, Lucide React, Recharts.
- **Backend:** Supabase (PostgreSQL, Auth, Storage, Realtime, Edge Functions).
- **GestÃ£o de Estado:** React Context API + Hooks Customizados.
- **ValidaÃ§Ã£o:** Zod (ObrigatÃ³rio em todos os forms).
- **Datas:** date-fns (PadrÃ£o pt-BR).
- **Drag & Drop:** @dnd-kit/core.
- **NotificaÃ§Ãµes:** Sonner (Toast).

## ğŸ¨ DESIGN SYSTEM & UI (ESTILO "CREXTIO")

- **Conceito:** Bento Grid, Glassmorphism, Clean & Modern.
- **Cores:**
  - Fundo Global: `bg-gray-50` (Nunca branco puro no body).
  - CartÃµes: `bg-white`, `rounded-3xl` (Bordas arredondadas grandes), `shadow-sm` ou `soft-shadow`.
  - Acentos: DegradÃªs suaves (Roxo Gaby, Verde Success).
- **Componentes:** Use sempre ShadcnUI como base, mas estilize com classes Tailwind para atingir o visual "Premium".

## ğŸ“ PADRÃ•ES DE CÃ“DIGO

### TypeScript
- **SEMPRE** use TypeScript strict mode.
- **NUNCA** use `any`. Use `unknown` se necessÃ¡rio e faÃ§a type guards.
- **SEMPRE** defina tipos explÃ­citos para props de componentes.
- **SEMPRE** use interfaces para objetos, types para unions/intersections.

### Nomenclatura
- **Componentes:** PascalCase (`UserProfile.tsx`)
- **Hooks:** camelCase com prefixo `use` (`useOnboarding.ts`)
- **FunÃ§Ãµes/Constantes:** camelCase (`getUserData`, `API_URL`)
- **Arquivos:** Mesmo padrÃ£o do conteÃºdo (componente = PascalCase, hook = camelCase)
- **Pastas:** kebab-case (`user-profile/`, `api-client/`)

### Estrutura de Arquivos
```
src/
  â”œâ”€â”€ components/     # Componentes reutilizÃ¡veis
  â”œâ”€â”€ pages/          # PÃ¡ginas/rotas
  â”œâ”€â”€ hooks/          # Custom hooks
  â”œâ”€â”€ lib/            # UtilitÃ¡rios, configuraÃ§Ãµes
  â”œâ”€â”€ types/          # DefiniÃ§Ãµes TypeScript
  â”œâ”€â”€ contexts/       # Context providers
  â””â”€â”€ utils/          # FunÃ§Ãµes auxiliares
```

### Imports
- **SEMPRE** use imports absolutos quando possÃ­vel (`@/components/...`)
- **SEMPRE** agrupe imports: externos â†’ internos â†’ relativos
- **SEMPRE** use named exports, evite default exports quando possÃ­vel

### Performance
- **SEMPRE** use `React.memo()` para componentes pesados que recebem props.
- **SEMPRE** use `useMemo()` e `useCallback()` quando apropriado.
- **NUNCA** faÃ§a fetch direto em componentes. Use hooks customizados.
- **SEMPRE** implemente loading states e error boundaries.

## ğŸš« PROIBIÃ‡Ã•ES ESTRITAS (NÃƒO FAÃ‡A)

1. **Colunas Legado:** NUNCA use `avatar_url` ou `created_at` nas tabelas `profiles` e `clients` em queries simples.
2. **SeguranÃ§a:** NUNCA escreva uma query ao Supabase sem considerar RLS (Row Level Security).
3. **UX:** NUNCA use `window.alert`. Use `Toast` (Sonner) ou `Dialog` (Shadcn).
4. **Performance:** NUNCA use `window.location.reload()`. Use atualizaÃ§Ã£o via Estado ou Supabase Realtime.
5. **TypeScript:** NUNCA use `any`, `@ts-ignore`, ou `as any`. Se necessÃ¡rio, use type guards.
6. **Console:** NUNCA deixe `console.log` em produÃ§Ã£o. Use ferramentas de logging adequadas.
7. **Erros:** NUNCA ignore erros silenciosamente. Sempre trate com try/catch e feedback ao usuÃ¡rio.

## ğŸ” REGRAS DE NEGÃ“CIO CRÃTICAS

1. **Financeiro (Sagrado):** O cÃ¡lculo de Split do Asaas deve respeitar o modelo do profissional (Porcentagem vs Aluguel).
2. **Gaby (IA LÃ³gica):** A Gaby opera baseada na tabela `gaby_rules`. Ela sugere, nÃ£o impÃµe.
3. **Mobile First:** O painel do Profissional deve ser 100% otimizado para toque (botÃµes grandes, swipe).
4. **RLS:** Todas as queries devem respeitar isolamento por `clinic_id`. Super admin tem acesso irrestrito.

## ğŸ§ª TESTES E QUALIDADE

- **SEMPRE** valide dados com Zod antes de enviar ao backend.
- **SEMPRE** trate erros de API com mensagens amigÃ¡veis ao usuÃ¡rio.
- **SEMPRE** verifique se RLS estÃ¡ funcionando antes de fazer deploy.
- **SEMPRE** teste em mobile antes de considerar completo.

## ğŸ“ PROTOCOLO DE REVISÃƒO

Antes de entregar qualquer cÃ³digo, verifique:

1. âœ… Isso quebra alguma Policy RLS?
2. âœ… O visual estÃ¡ no padrÃ£o "Crextio" (arredondado, clean)?
3. âœ… Isso funciona no celular do profissional?
4. âœ… TypeScript estÃ¡ sem erros (`tsc --noEmit`)?
5. âœ… NÃ£o hÃ¡ `any`, `console.log`, ou `window.alert`?
6. âœ… Erros estÃ£o sendo tratados adequadamente?
7. âœ… ValidaÃ§Ã£o Zod estÃ¡ implementada nos forms?

## ğŸ”„ WORKFLOW DE DESENVOLVIMENTO

1. **Antes de comeÃ§ar:** Leia o contexto do projeto, especialmente RLS e regras de negÃ³cio.
2. **Durante desenvolvimento:** FaÃ§a commits pequenos e atÃ´micos.
3. **Antes de commit:** Execute `tsc --noEmit` e verifique linter.
4. **ApÃ³s mudanÃ§as crÃ­ticas:** Teste RLS e validaÃ§Ãµes manualmente.

## ğŸ“š DOCUMENTAÃ‡ÃƒO

- **SEMPRE** documente funÃ§Ãµes complexas com JSDoc.
- **SEMPRE** mantenha README.md atualizado.
- **SEMPRE** documente decisÃµes arquiteturais importantes.
